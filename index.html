<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shadow Control</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --bg-color: var(--tg-theme-bg-color, #fff);
            --text-color: var(--tg-theme-text-color, #000);
            --btn-color: var(--tg-theme-button-color, #3390ec);
            --btn-text: var(--tg-theme-button-text-color, #fff);
            --hint-color: var(--tg-theme-hint-color, #999);
            --secondary-bg: var(--tg-theme-secondary-bg-color, #f0f0f0);
            --section-header: var(--tg-theme-link-color, #3390ec);
        }
        
        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; 
            background-color: var(--bg-color); 
            color: var(--text-color); 
            padding: 15px; 
            margin: 0; 
            user-select: none;
        }
        
        .container { display: none; flex-direction: column; gap: 15px; }
        .active { display: flex; }

        /* INPUTS */
        input[type="text"], input[type="number"], input[type="tel"], input[type="password"], textarea { 
            width: 100%; 
            padding: 12px; 
            border: 1px solid var(--hint-color); 
            border-radius: 12px; 
            box-sizing: border-box; 
            background: transparent; 
            color: var(--text-color); 
            font-size: 16px; 
            outline: none;
            transition: border-color 0.2s;
        }
        
        input:focus, textarea:focus {
            border-color: var(--btn-color);
            border-width: 2px;
            padding: 11px; /* –ö–æ–º–ø–µ–Ω—Å–∞—Ü–∏—è —à–∏—Ä–∏–Ω—ã –≥—Ä–∞–Ω–∏—Ü—ã */
        }

        /* BUTTONS */
        button { 
            width: 100%; 
            padding: 14px; 
            background-color: var(--btn-color); 
            color: var(--btn-text); 
            border: none; 
            border-radius: 12px; 
            font-weight: 600; 
            cursor: pointer; 
            font-size: 16px; 
            margin-top: 10px; 
        }
        button:active { opacity: 0.8; transform: scale(0.98); }
        
        button.secondary {
            background-color: transparent;
            color: var(--btn-color);
            border: 2px solid var(--btn-color);
        }

        /* TABS */
        .tabs { 
            display: flex; 
            gap: 5px; 
            margin-bottom: 15px; 
            background: var(--secondary-bg); 
            padding: 4px; 
            border-radius: 12px; 
        }
        
        .tab { 
            flex: 1; 
            padding: 8px; 
            text-align: center; 
            cursor: pointer; 
            border-radius: 8px; 
            font-size: 14px; 
            font-weight: 500; 
            color: var(--hint-color); 
            transition: 0.2s; 
        }
        
        .tab.active-tab { 
            background: var(--bg-color); 
            color: var(--text-color); 
            box-shadow: 0 2px 4px rgba(0,0,0,0.1); 
        }

        /* SETTINGS ROWS */
        h4 { margin: 20px 0 10px 0; color: var(--section-header); font-size: 14px; text-transform: uppercase; letter-spacing: 0.5px; }
        h3 { margin: 0 0 15px 0; text-align: center; }
        
        .setting-row { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            padding: 12px 0; 
            border-bottom: 1px solid var(--secondary-bg); 
        }
        .setting-row span { font-size: 16px; }

        /* TOGGLE SWITCH */
        .switch { position: relative; display: inline-block; width: 50px; height: 28px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: var(--secondary-bg); border: 1px solid var(--hint-color); transition: .4s; border-radius: 34px; }
        .slider:before { position: absolute; content: ""; height: 20px; width: 20px; left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%; box-shadow: 0 2px 4px rgba(0,0,0,0.2); }
        input:checked + .slider { background-color: var(--btn-color); border-color: var(--btn-color); }
        input:checked + .slider:before { transform: translateX(22px); }

        .hint-text { font-size: 13px; color: var(--hint-color); margin-top: 5px; }
    </style>
</head>
<body>

    <div id="screen-login" class="container">
        <h3>–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–∞</h3>
        
        <div class="tabs">
            <div class="tab active-tab" onclick="switchTab('phone')">–ü–æ –Ω–æ–º–µ—Ä—É</div>
            <div class="tab" onclick="switchTab('qr')">–ü–æ QR –∫–æ–¥—É</div>
        </div>

        <div style="display: flex; flex-direction: column; gap: 10px;">
            <label class="hint-text">–î–∞–Ω–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (my.telegram.org)</label>
            <input type="number" id="api_id" placeholder="API ID">
            <input type="text" id="api_hash" placeholder="API HASH">
        </div>
        
        <div id="phone-group" style="margin-top: 10px;">
            <input type="tel" id="phone" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω (+7...)">
        </div>

        <button onclick="sendLogin()" id="btn-login">–í–æ–π—Ç–∏</button>
        <div class="hint-text" style="text-align: center; margin-top: 20px;">
            –í–∞—à–∏ –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ –Ω–∞ –≤—ã–¥–µ–ª–µ–Ω–Ω–æ–º —Å–µ—Ä–≤–µ—Ä–µ –≤ –≤–∞—à–µ–π –ª–∏—á–Ω–æ–π –ø–∞–ø–∫–µ.
        </div>
    </div>

    <div id="screen-code" class="container">
        <h3>–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ</h3>
        <p class="hint-text" style="text-align: center;">–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –∏–∑ —Å–µ—Ä–≤–∏—Å–Ω—ã—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π Telegram</p>
        <input type="number" id="auth_code" placeholder="–ö–æ–¥" style="font-size: 24px; text-align: center; letter-spacing: 5px;">
        <button onclick="sendAuthCode()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
    </div>

    <div id="screen-password" class="container">
        <h3>–û–±–ª–∞—á–Ω—ã–π –ø–∞—Ä–æ–ª—å</h3>
        <input type="password" id="2fa_pass" placeholder="–í–∞—à –ø–∞—Ä–æ–ª—å">
        <button onclick="sendPass()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
    </div>

    <div id="screen-settings" class="container">
        <h3>–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</h3>
        
        <div style="background: var(--secondary-bg); padding: 15px; border-radius: 12px; display: flex; justify-content: space-between; align-items: center;">
            <span style="font-weight: bold;">–°—Ç–∞—Ç—É—Å –í–æ—Ä–∫–µ—Ä–∞</span>
            <button onclick="checkStatus()" style="width: auto; margin: 0; padding: 8px 15px; font-size: 14px;">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å</button>
        </div>
        <div class="hint-text">–ù–∞–∂–º–∏—Ç–µ "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å", —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –æ—Ç—á–µ—Ç –≤ —á–∞—Ç –±–æ—Ç–∞.</div>

        <h4>–§–∏–ª—å—Ç—Ä—ã</h4>
        <div class="setting-row">
            <span>–°–ª–µ–¥–∏—Ç—å –∑–∞ –≥—Ä—É–ø–ø–∞–º–∏</span>
            <label class="switch"><input type="checkbox" id="track_groups"><span class="slider"></span></label>
        </div>
        
        <h4>–¢–∏–ø—ã —Å–æ–±—ã—Ç–∏–π</h4>
        <div class="setting-row">
            <span>–£–¥–∞–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π</span>
            <label class="switch"><input type="checkbox" id="evt_del" checked><span class="slider"></span></label>
        </div>
        <div class="setting-row">
            <span>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ</span>
            <label class="switch"><input type="checkbox" id="evt_edit" checked><span class="slider"></span></label>
        </div>
        <div class="setting-row">
            <span>–ò—Å—á–µ–∑–∞—é—â–∏–µ (Self-destruct)</span>
            <label class="switch"><input type="checkbox" id="evt_vo" checked><span class="slider"></span></label>
        </div>

        <h4>–ò—Å–∫–ª—é—á–µ–Ω–∏—è</h4>
        <label class="hint-text">ID —á–∞—Ç–æ–≤ —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é, –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω–æ –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å:</label>
        <textarea id="ignore_chats" rows="2" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 12345678, -100987654"></textarea>

        <button onclick="saveSettings()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏ –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å</button>
        <div class="hint-text" style="text-align: center;">–ò–∑–º–µ–Ω–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç –≤–∞—à –ø—Ä–æ—Ü–µ—Å—Å –≤–æ—Ä–∫–µ—Ä–∞.</div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ URL –¥–ª—è –≤—ã–±–æ—Ä–∞ —ç–∫—Ä–∞–Ω–∞
        let loginMode = 'phone';
        const urlParams = new URLSearchParams(window.location.search);
        const mode = urlParams.get('mode'); // code, password, settings

        // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ —ç–∫—Ä–∞–Ω—ã
        document.querySelectorAll('.container').forEach(el => el.classList.remove('active'));

        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω—É–∂–Ω—ã–π
        if (mode === 'code') {
            document.getElementById('screen-code').classList.add('active');
        } else if (mode === 'password') {
            document.getElementById('screen-password').classList.add('active');
        } else if (mode === 'settings' || window.location.hash === '#settings') {
            document.getElementById('screen-settings').classList.add('active');
            // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –±—ã–ª–æ –±—ã –ø—Ä–µ–¥–∑–∞–ø–æ–ª–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏, –µ—Å–ª–∏ –±—ã –º—ã –ø–µ—Ä–µ–¥–∞–≤–∞–ª–∏ –∏—Ö –≤ URL
        } else {
            document.getElementById('screen-login').classList.add('active');
        }

        // --- –õ–û–ì–ò–ö–ê –ê–í–¢–û–†–ò–ó–ê–¶–ò–ò ---
        function switchTab(m) {
            loginMode = m;
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active-tab'));
            event.target.classList.add('active-tab');
            
            const phGroup = document.getElementById('phone-group');
            const btn = document.getElementById('btn-login');
            
            if (m === 'qr') {
                phGroup.style.display = 'none';
                btn.innerText = "–ü–æ–ª—É—á–∏—Ç—å QR –∫–æ–¥";
            } else {
                phGroup.style.display = 'block';
                btn.innerText = "–í–æ–π—Ç–∏";
            }
        }

        function sendLogin() {
            const api_id = document.getElementById('api_id').value;
            const api_hash = document.getElementById('api_hash').value;
            const phone = document.getElementById('phone').value;

            if (!api_id || !api_hash) return tg.showAlert("–ó–∞–ø–æ–ª–Ω–∏—Ç–µ API ID –∏ Hash");
            if (loginMode === 'phone' && !phone) return tg.showAlert("–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞");

            const data = {
                action: loginMode === 'phone' ? "init_phone" : "init_qr",
                api_id: api_id,
                api_hash: api_hash,
                phone: loginMode === 'phone' ? phone : null
            };
            tg.sendData(JSON.stringify(data));
        }

        function sendAuthCode() {
            const code = document.getElementById('auth_code').value;
            if (!code) return tg.showAlert("–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥!");
            tg.sendData(JSON.stringify({ action: "submit_code", code: code }));
        }

        function sendPass() {
            const pass = document.getElementById('2fa_pass').value;
            if (!pass) return tg.showAlert("–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å!");
            tg.sendData(JSON.stringify({ action: "submit_password", password: pass }));
        }

        // --- –õ–û–ì–ò–ö–ê –ù–ê–°–¢–†–û–ï–ö ---
        function checkStatus() {
            // –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º —Å—Ç–∞—Ç—É—Å, –±–æ—Ç –æ—Ç–≤–µ—Ç–∏—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ–º –≤ —á–∞—Ç
            tg.sendData(JSON.stringify({ action: "get_status" }));
        }

        function saveSettings() {
            const settings = {
                track_groups: document.getElementById('track_groups').checked,
                events: {
                    deleted: document.getElementById('evt_del').checked,
                    edited: document.getElementById('evt_edit').checked,
                    view_once: document.getElementById('evt_vo').checked
                },
                // –°–æ–±–∏—Ä–∞–µ–º —Å—Ç—Ä–æ–∫—É ID
                ignore_chats_str: document.getElementById('ignore_chats').value
            };

            tg.sendData(JSON.stringify({
                action: "save_settings",
                settings: settings
            }));
        }
    </script>
</body>
</html>
